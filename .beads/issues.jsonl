{"id":"debian-repro-0yl","title":"No tests for consensus comparison logic","description":"## Problem\n\nThe consensus comparison logic in `scripts/compare-platforms.sh` has no test coverage. This is critical security logic that determines if platforms agree.\n\n## Evidence\n\n```bash\n$ ls tests/\nrun-tests.sh\n```\n\nNo tests for:\n- `compare-platforms.sh`\n- `collect-results.sh`\n- Edge cases: single platform, partial results, checksum format variations\n\n## Impact\n\n- Bugs in consensus logic could miss real disagreements (false negatives)\n- Or flag false positives causing alert fatigue\n- Refactoring could break consensus detection silently\n\n## What needs testing\n\n1. **Basic consensus**: Two platforms, same checksums ‚Üí pass\n2. **Disagreement detection**: Two platforms, different checksums ‚Üí fail\n3. **Single platform handling**: Should fail (currently does)\n4. **Missing results**: One platform has results, other doesn't\n5. **Malformed input**: Invalid JSON, missing fields\n6. **Evidence generation**: Verify witness files created on disagreement\n\n## Implementation\n\nAdd BATS tests in `tests/`:\n```bash\n# tests/compare-platforms.bats\n@test \"consensus passes when platforms agree\" {\n  # Setup mock results\n  # Run compare-platforms.sh\n  # Assert exit 0\n}\n\n@test \"consensus fails when platforms disagree\" {\n  # Setup divergent mock results\n  # Run compare-platforms.sh\n  # Assert exit 1\n}\n```\n\n## Files to create/modify\n\n- tests/compare-platforms.bats (new)\n- tests/collect-results.bats (new)","status":"open","priority":2,"issue_type":"bug","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:20:12.829934-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:20:12.829934-05:00"}
{"id":"debian-repro-2dn","title":"Security doc falsely claims artifacts repo tampering is detected","description":"## Problem\n\ndocs/security.md claims the system detects \"Artifacts repository changes\" but this is false. The `docker-debian-artifacts` repository is the single trust point - the system trusts it unconditionally and cannot detect tampering.\n\n## Evidence\n\ndocs/security.md states:\n```\n| **Artifacts repository changes** | Yes | Unauthorized checksum changes detected |\n```\n\nBut the code unconditionally trusts whatever it clones:\n```bash\n# scripts/fetch-official.sh - no validation\ngit clone --depth 1 --single-branch --branch \"$branch\" \\\n  https://github.com/debuerreotype/docker-debian-artifacts.git\n\nserial=$(cat serial)                    # Trusted without verification\nepoch=$(cat debuerreotype-epoch)        # Trusted without verification\ncp \"$suite/rootfs.tar.xz.sha256\" ...   # Trusted without verification\n```\n\nThis contradicts docs/architecture.md which correctly identifies this as a \"single trust point.\"\n\n## Impact\n\n- False security assurance to users\n- Incorrect threat model documentation\n- Potential compliance/audit issues if users rely on this claim\n\n## Why detection is impossible\n\nThe system uses the artifacts repo as ground truth for comparisons. If an attacker modifies the repo:\n1. Changes checksums to match backdoored images\n2. Updates epoch/serial to match malicious builds\n3. Our builds would then \"match\" the malicious reference\n\n## Fix\n\nUpdate docs/security.md to:\n1. Change the table entry to show this is NOT detected\n2. Add explanation in Trust Dependencies section\n\n```markdown\n# In the detection table:\n| **Artifacts repository changes** | No | Single trust point (see Trust Dependencies) |\n\n# Add to Trust Dependencies section:\n### Single Trust Point\n\nThe `docker-debian-artifacts` repository is our source of truth. We do not validate its integrity beyond cloning. A compromise of this repository would not be detected by our system. Multi-platform consensus and registry verification protect against downstream tampering but not upstream.\n```\n\n## Files to modify\n\n- docs/security.md","status":"open","priority":1,"issue_type":"bug","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:12:41.811116-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:12:41.811116-05:00"}
{"id":"debian-repro-6y8","title":"Debuerreotype version mismatch breaks consensus","description":"## Problem\n\nGitHub Actions uses debuerreotype commit `e044a8f` (post-0.16 with distro-info-data fix), while GCP cloudbuild.yaml and verify-local.sh use tag `0.16`. This version divergence will cause consensus validation to fail or mask real issues.\n\n## Evidence\n\n- `.github/workflows/reproducible-debian-build.yml` line 35: `DEBUERREOTYPE_VERSION: 'e044a8f'`\n- `cloudbuild.yaml` line 17: `_DEBUERREOTYPE_VERSION: '0.16'`\n- `verify-local.sh` line 127: `DEBUERREOTYPE_VERSION=\"0.16\"`\n\n## Impact\n\nConsensus validation requires identical checksums across platforms. Different debuerreotype versions may produce different outputs, causing:\n1. False consensus failures (versions produce different valid outputs)\n2. Masked tampering (real issues hidden by expected differences)\n\n## Fix\n\nUpdate cloudbuild.yaml and verify-local.sh to use `e044a8f`:\n\n```yaml\n# cloudbuild.yaml\n_DEBUERREOTYPE_VERSION: 'e044a8f'\n```\n\n```bash\n# verify-local.sh\nDEBUERREOTYPE_VERSION=\"e044a8f\"\n```\n\nAlso update the checkout command in cloudbuild.yaml step 'setup-debuerreotype' since it uses `--branch` which works for tags but commit SHAs need different handling.\n\n## Files to modify\n\n- cloudbuild.yaml\n- verify-local.sh","status":"open","priority":0,"issue_type":"bug","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:12:16.074119-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:12:16.074119-05:00"}
{"id":"debian-repro-apu","title":"GCP builds not triggered from GitHub - consensus requires manual intervention","description":"## Problem\n\nThe consensus validation workflow collects results from GCP but nothing triggers GCP builds. Without GCP results, consensus validation fails by design (requires 2+ platforms). This means multi-platform consensus is not actually automated.\n\n## Evidence\n\n1. `cloudbuild.yaml` exists but no GitHub workflow triggers it\n2. `consensus-validator.yml` lines 85-89 try to collect GCP results:\n   ```yaml\n   if [ \"$GCP_CREDS_AVAILABLE\" = \"true\" ] \u0026\u0026 [ -n \"$GCP_PROJECT\" ]; then\n     COLLECT_CMD=\"$COLLECT_CMD --gcp-project $GCP_PROJECT\"\n   ```\n3. `consensus-validator.yml` line 97 fails if only one platform:\n   ```bash\n   if [[ \"$PLATFORMS\" != *\",\"* ]]; then\n     echo \"‚ö†Ô∏è Only one platform available - consensus validation requires 2+ platforms\"\n     exit 1\n   fi\n   ```\n\n4. No workflow uses `gcloud builds submit` to trigger GCP builds\n\n## Current state\n\n- GitHub Actions builds run weekly (Sunday 00:00 UTC)\n- Consensus validator runs weekly (Monday 06:00 UTC)\n- GCP builds require external trigger (Cloud Build triggers or manual `gcloud builds submit`)\n- If GCP builds don't run, consensus validation always fails\n\n## Impact\n\n- Multi-platform consensus is not automated end-to-end\n- The security benefit of independent platforms requires manual coordination\n- Users may think consensus is working when it's not\n\n## Options\n\n### Option A: Document the gap (minimal)\nAdd to docs/consensus-validation-guide.md:\n```markdown\n## Current Limitation: Manual GCP Triggers\n\nThe consensus workflow collects results from GCP but does not trigger GCP builds.\nGCP builds must be triggered externally via:\n- Cloud Build triggers (recommended)\n- Manual: `gcloud builds submit --config=cloudbuild.yaml`\n\nWithout GCP results, consensus validation fails by design (requires 2+ platforms).\n```\n\n### Option B: Add GCP trigger workflow (full automation)\nCreate `.github/workflows/trigger-gcp-build.yml` that:\n1. Runs after `reproducible-debian-build.yml` completes\n2. Uses `gcloud builds submit --config=cloudbuild.yaml`\n3. Waits for completion before consensus validator runs\n\n### Option C: Use Cloud Build triggers\nConfigure GCP Cloud Build triggers to run on:\n- Same schedule as GitHub Actions\n- Or webhook from GitHub workflow completion\n\n## Files to modify\n\nOption A: docs/consensus-validation-guide.md\nOption B: Create .github/workflows/trigger-gcp-build.yml\nOption C: GCP console configuration (external)","status":"open","priority":2,"issue_type":"bug","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:12:58.363866-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:12:58.363866-05:00","dependencies":[{"issue_id":"debian-repro-apu","depends_on_id":"debian-repro-6y8","type":"blocks","created_at":"2026-02-03T23:13:14.444435-05:00","created_by":"Shiloh Heurich"}]}
{"id":"debian-repro-ebc","title":"Scheduled builds default to only 2/5 suites","description":"## Problem\n\nBoth GitHub Actions and GCP scheduled builds default to only 'bookworm trixie', missing bullseye, forky (testing), and unstable. This reduces verification coverage.\n\n## Evidence\n\n`.github/workflows/reproducible-debian-build.yml` line 7-9:\n```yaml\nsuites:\n  default: 'bookworm trixie'\n```\n\nREADME.md claims:\n```\n**Suites:**\n- forky (testing)\n- trixie (stable)\n- bookworm (oldstable)\n- bullseye (oldoldstable)\n- unstable (sid)\n```\n\n## Impact\n\n- Supply chain attacks on bullseye, forky, or unstable images not detected by automated builds\n- Users relying on oldoldstable or testing suites have no automated verification\n\n## Considerations\n\n- More suites = longer build times and higher CI costs\n- Some suites may be intentionally excluded (bullseye approaching EOL)\n- forky/unstable are less stable targets\n\n## Fix options\n\n1. **Expand default** to all suites (most thorough)\n2. **Document exclusions** in README if intentional\n3. **Add separate workflow** for extended verification\n\n## Files to modify\n\n- .github/workflows/reproducible-debian-build.yml\n- cloudbuild.yaml\n- README.md (if documenting intentional exclusions)","status":"open","priority":2,"issue_type":"bug","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:19:48.80095-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:19:48.80095-05:00"}
{"id":"debian-repro-l9x","title":"Architecture doc is stale - claims Docker Hub gap exists but registry verification is implemented","description":"## Problem\n\ndocs/architecture.md still describes Docker Hub verification as a gap and planned feature, but it's already implemented. This creates confusion about the system's actual capabilities.\n\n## Evidence\n\ndocs/architecture.md contains:\n```\n‚îÇ Docker Hub ‚îÇ\n‚îÇ (gap)      ‚îÇ\n...\n**Gap**: We don't verify Docker Hub images match the artifacts repository.\n**Planned**: Direct Docker Hub verification closes this gap.\n```\n\nBut registry verification is fully implemented:\n- `.github/workflows/registry-verification.yml` - daily automated workflow\n- `scripts/verify-registry.sh` - compares diff_ids between Docker Hub and artifacts\n- `docs/registry-verification.md` - complete documentation\n\n## Impact\n\n- New contributors get incorrect understanding of system capabilities\n- Security assessors may incorrectly report Docker Hub as unverified\n- Documentation doesn't reflect actual security posture\n\n## Fix\n\nUpdate docs/architecture.md to:\n1. Remove the \"(gap)\" label from Docker Hub in the diagram\n2. Replace the Gap/Planned section with description of implemented registry verification\n3. Add reference to docs/registry-verification.md\n4. Update the trust diagram to show the verification link\n\nSuggested replacement for the trust section:\n```markdown\n## Trust Model\n\nThe `docker-debian-artifacts` repository is our single trust point. Registry verification (see [Registry Verification](registry-verification.md)) closes the gap between the artifacts repository and Docker Hub by comparing diff_ids daily.\n```\n\n## Files to modify\n\n- docs/architecture.md","status":"open","priority":1,"issue_type":"bug","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:12:28.088896-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:12:28.088896-05:00"}
{"id":"debian-repro-ohx","title":"Registry verification defaults to only 2/5 architectures","description":"## Problem\n\nRegistry verification workflow defaults to only amd64 and arm64, missing armhf, i386, and ppc64el. This leaves 60% of supported architectures unverified for Docker Hub tampering.\n\n## Evidence\n\n`.github/workflows/registry-verification.yml` line 12-13:\n```yaml\narchitectures:\n  default: 'amd64,arm64'\n```\n\nBut README.md claims coverage for all 5 architectures:\n```\n**Architectures:**\n- Supported: amd64, arm64, armhf, i386, ppc64el\n```\n\n## Impact\n\nDocker Hub tampering on armhf, i386, or ppc64el images would go undetected by daily automated verification.\n\n## Fix\n\nChange default to include all architectures:\n```yaml\ndefault: 'amd64,arm64,armhf,i386,ppc64el'\n```\n\n## Files to modify\n\n- .github/workflows/registry-verification.yml","status":"open","priority":1,"issue_type":"bug","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:19:39.605866-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:19:39.605866-05:00"}
{"id":"debian-repro-p31","title":"Add validation of docker-debian-artifacts repository integrity","description":"## Problem\n\nThe `docker-debian-artifacts` repository is a single trust point with no integrity validation. A compromise of this repository would not be detected.\n\n## Current state\n\n`scripts/fetch-official.sh` clones the repository and trusts all contents unconditionally:\n- No GPG signature verification\n- No comparison against historical values\n- No multi-source validation\n\n## Potential mitigations\n\n### 1. Historical comparison (detect sudden changes)\nStore previous serial/epoch values and alert on unexpected jumps:\n```bash\n# Compare new serial against last known\nif [ \"$new_serial\" != \"$last_serial\" ]; then\n  # Validate jump is reasonable (not too far in past/future)\n  # Alert if unexpected\nfi\n```\n\n### 2. Multi-source validation\nCross-reference against other Debian sources:\n- Check snapshot.debian.org exists for claimed serial\n- Verify epoch is within expected range\n- Compare against Docker Hub image creation timestamps\n\n### 3. GPG verification (if available)\nIf Debian signs the artifacts repo or individual files, verify signatures.\n\n### 4. Commit signing verification\nVerify commits to docker-debian-artifacts are signed by known Debian keys.\n\n## Scope\n\nThis is an enhancement to reduce trust surface. Complete elimination of this trust point is not possible since we need a reference to compare against.\n\n## Files to potentially modify\n\n- scripts/fetch-official.sh (add validation)\n- scripts/common.sh (add validation functions)\n- New: scripts/validate-artifacts-repo.sh\n\n## Related\n\nThis is explicitly documented as out-of-scope in docs/security.md but could be a roadmap item.","status":"open","priority":3,"issue_type":"feature","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:13:10.257408-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:13:10.257408-05:00"}
{"id":"debian-repro-umi","title":"No alerting mechanism for verification failures","description":"## Problem\n\nWhen verification fails (reproducibility mismatch, consensus failure, or registry tampering), there's no notification mechanism. The dashboard updates silently. This defeats the purpose of detecting supply chain attacks if no one is alerted.\n\n## Evidence\n\nSearched all workflows - no notification steps found:\n- No Slack/Discord/email integrations\n- No GitHub issue creation on failure\n- No webhook triggers\n\nWorkflows only update dashboard and exit with failure code:\n```bash\n# From verify-checksum.sh\nexit 1  # Silent failure, no notification\n```\n\n## Impact\n\n- **Critical**: Supply chain attack detection is useless if no one sees the alert\n- Human must manually check dashboard or CI status\n- Weekend/holiday attacks could go unnoticed for days\n\n## Proposed solutions\n\n1. **GitHub Actions native**: Create issue or discussion on failure\n2. **Webhook**: POST to monitoring endpoint\n3. **Email**: Use `dawidd6/action-send-mail` action\n4. **Slack/Discord**: Post to security channel\n\n## Implementation sketch\n\nAdd to `reproducible-debian-build.yml`:\n```yaml\nalert-on-failure:\n  needs: [build]\n  if: failure()\n  runs-on: ubuntu-24.04\n  steps:\n    - uses: actions/github-script@v7\n      with:\n        script: |\n          github.rest.issues.create({\n            owner: context.repo.owner,\n            repo: context.repo.repo,\n            title: 'üö® Reproducibility verification failed',\n            body: 'Build ${{ github.run_id }} detected non-reproducible images...',\n            labels: ['security', 'alert']\n          })\n```\n\n## Files to modify\n\n- .github/workflows/reproducible-debian-build.yml\n- .github/workflows/registry-verification.yml\n- .github/workflows/consensus-validator.yml","status":"open","priority":1,"issue_type":"bug","owner":"shiloh@heurich.com","created_at":"2026-02-03T23:20:02.908959-05:00","created_by":"Shiloh Heurich","updated_at":"2026-02-03T23:20:02.908959-05:00"}
